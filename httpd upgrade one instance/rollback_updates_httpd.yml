---
  - name: Rollback Upgrade Task
    hosts: "{{ specific_host }}"
    gather_facts: no
    become: yes

    ## specific_host
    ## updated_httpd_service
    ## existing_httpd_service
    ## updated_apache_directory
  

    tasks:
      - name: Stop Updated Httpd service
        command: "systemctl stop {{updated_httpd_service}}.service"
        become: yes
        async: 100
        poll: 5
        register: stop_updated_httpd

      - name: Disable existing httpd service
        command: "systemctl disable {{ updated_httpd_service }}.service"
        become: yes

      - name: Delete updated httpd service
        file:
          path: /etc/systemd/system/{{ updated_httpd_service }}.service
          state: absent

      - name: Delete updated httpd folder
        file:
          path: /opt/{{ updated_apache_directory }}
          state: absent

      - name: Start Previous Httpd service
        command: "systemctl start {{ existing_httpd_service }}.service"
        become: yes
        async: 100
        poll: 5
        register: start_previous_httpd

      - name: Enable previous httpd service
        command: "systemctl enable {{ existing_httpd_service }}.service"
        become: yes